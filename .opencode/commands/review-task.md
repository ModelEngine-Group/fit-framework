---
description: 审查任务实现并输出代码审查报告
agent: general
subtask: false
---

审查任务 $1 的代码实现。

执行以下步骤:

1. 验证前置条件:
   !`test -f .ai-workspace/active/$1/task.md && echo "✅ 任务文件存在" || echo "❌ ERROR: 任务文件不存在"`
   !`test -f .ai-workspace/active/$1/implementation.md && echo "✅ 实现报告存在" || echo "❌ ERROR: 实现报告不存在,请先执行 /implement $1"`
   
   读取实现报告,了解已修改的文件和实现的功能

2. 执行代码审查,检查:
   - 代码质量和编码规范(遵循项目规范)
   - Bug 和潜在问题检测
   - 测试覆盖率和测试质量
   - 错误处理和边界情况
   - 性能和安全问题
   - 代码注释和文档
   - 与技术方案的一致性

3. 输出审查报告到 review.md,包含:
   - 审查概要(审查者、时间、范围、总体评价)
   - 审查发现:
     - 🔴 必须修复(Blocker): 阻塞问题,必须修复才能合并
     - 🟡 建议修改(Major): 重要建议,强烈推荐修复
     - 🟢 优化建议(Minor): 可选优化
   - 优点与亮点(做得好的地方)
   - 规范检查(编码规范、测试规范等)
   - 测试审查(测试覆盖、测试质量)
   - 安全审查(SQL注入、XSS、权限控制等)
   - 性能审查(算法复杂度、数据库查询等)
   - 与方案的一致性
   - 总结与建议(是否批准、下一步行动)

4. 更新任务状态:
   - current_step: code-review
   - updated_at: 当前时间
   - 在工作流进度中标记代码审查为完成

5. 告知用户:
   - 输出审查结果(必须修复、建议修改、优化建议的数量和总体评价)
   - 显示输出文件路径
   - 根据审查结果给出建议:
     - 如果无阻塞问题: 使用 /commit 提交代码
     - 如果有需要修改项: 使用 /refine $1 修复问题
     - 如果需要重大修改: 回到 /implement $1 重新实施

**审查原则**:
- 严格但公正,既要指出问题,也要认可优点
- 具体明确,给出具体的文件和行号
- 提供建议,不仅指出问题,还要提供改进建议
- 分级处理,区分必须修复和建议优化

**注意事项**:
- 必须先完成代码实现(implementation.md 存在)
- 严格遵循项目编码规范
- 重点关注安全性和性能问题
- 确保测试覆盖充分
