---
description: 为任务设计技术方案并输出实施计划
agent: general
subtask: false
---

为任务 $1 设计技术方案。

执行以下步骤:

1. 查找任务文件:
   !`test -f .ai-workspace/active/$1/task.md && echo "✅ 任务存在于 active" || echo "⚠️  任务不在 active 目录"`
   
   如果不在 active 目录,检查其他目录:
   !`find .ai-workspace -type f -path "*/$1/task.md" 2>/dev/null || echo "❌ ERROR: 任务不存在"`
   
   读取 task.md 和 analysis.md

2. 理解问题本质和约束条件:
   - 阅读 analysis.md，理解问题的根本原因和影响范围
   - 识别技术约束（从 analysis.md 的"技术依赖和约束"章节获取）
   - 识别特殊要求（例如：安全修复需要考虑漏洞修复版本、Bug修复需要防止回归、功能开发需要考虑扩展性）
   
3. 设计解决方案:
   - 基于 analysis.md 中的信息，提出多个可行方案
   - 对比各方案的优劣（效果、成本、风险、可维护性）
   - 选择最合适的方案并说明理由
   - 制定详细的实施步骤
   - 列出需要创建/修改的文件清单
   - 设计验证策略（测试、验证、回归检查）
   - 评估影响（性能、安全、兼容性）
   - 制定风险控制和回滚方案

4. 输出方案文档到 plan.md,包含:
   - 方案决策
     - 问题理解（基于 analysis.md 的理解）
     - 约束条件（技术约束、业务约束、时间约束）
     - 备选方案对比分析
     - 最终选择及理由
   - 技术方案
     - 核心解决策略
     - 关键技术点
     - 具体实现细节（根据问题类型，可能包括：代码实现、依赖升级、配置调整等）
   - 实施步骤
     - 详细的步骤列表
     - 每步的操作和预期结果
   - 文件清单
     - 需要创建的文件
     - 需要修改的文件（包括所有相关文件：代码、配置、依赖文件等）
   - 验证策略
     - 功能验证（单元测试、集成测试）
     - 问题验证（确认问题已解决，如：功能正常、Bug不再复现、漏洞已修复）
     - 回归验证（确保没有引入新问题）
   - 影响评估
     - 性能影响
     - 安全影响
     - 兼容性影响
   - 风险控制
     - 潜在风险及应对措施
     - 回滚方案
   - 预期产出

5. 更新任务状态:
   - current_step: technical-design
   - updated_at: 当前时间
   - 在工作流进度中标记技术方案设计为完成

6. 告知用户:
   - 输出方案概要(最终方案、工作量、风险等级)
   - 显示输出文件路径
   - **提示这是人工审查检查点,需要审查后才能继续**
   - 审查通过后使用 /implement $1 开始实施

**注意事项**:
- 必须先完成需求分析(analysis.md 存在)
  - 功能开发/Bug修复: 先执行 /analyze-issue
  - 安全修复: 先执行 /analyze-security
- 这是一个**必须**的人工检查点,方案设计完成后等待人工审查
- 充分思考,考虑多个方案并对比
- 确保所有必需章节都包含

**相关命令**:
- /analyze-issue - 分析 Issue (前置步骤)
- /analyze-security - 分析安全告警 (前置步骤)
- /implement-task - 实施任务 (后续步骤)
- /task-status - 查看任务状态
